name: firestore-bundle-builder
version: 0.1.0
displayName: Firestore Bundle Builder
description: >-
  Provides cached serving of Firestore bundles.

roles:
  - role: datastore.user
    reason: Allows the extension to read Firestore configuration and build bundles from Firestore.
  - role: storage.objectAdmin
    reason: Allows the extension to save built bundles in Cloud Storage

resources:
  - name: serve
    description: >-
      HTTPS function that serves bundled content from Cloud Storage cache or by dynamically building.

params:
  - param: BUNDLESPEC_COLLECTION
    type: string
    label: Collection to store bundle specification documents
    description: >-
      Path to the Firestore collection that contains the specifications of the
      bundles the extension will build.
    default: bundles
    required: true
    immutable: false

  - param: BUNDLE_STORAGE_BUCKET
    type: string
    label: Google Cloud Storage bucket to save the built bundle files
    description: >-
      The Cloud Storage bucket to save the built bundle files. This applies when
      the bundle specification has `fileCache` enabled.
    validationRegex: ^([0-9a-z_.-]*)$
    validationErrorMessage: Invalid storage bucket
    default: ${STORAGE_BUCKET}
    required: false
    immutable: false

  - param: STORAGE_PREFIX
    type: string
    label: Prefix to use for bundle files saved in Google Cloud Storage.
    description: >-
      The prefix for all the bundle files built and saved in Cloud Storage.
      This applies when the bundle specification has `fileCache` enabled.
    required: false
    immutable: false
